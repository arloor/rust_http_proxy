<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>{{ hostname }}ç½‘é€Ÿ</title>
  <style>
    html,
    body {
      margin: 0;
    }

    .app-container {
      display: flex;
      flex-direction: column;
      height: 100vh;
      width: 100vw;
      overflow: hidden;
    }

    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 20px;
      background: linear-gradient(135deg, #5f72bd 0%, #9921e8 100%);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      z-index: 100;
    }

    .backend-info {
      display: flex;
      align-items: center;
      gap: 12px;
      color: white;
      font-size: 14px;
      flex: 1;
    }

    .backend-label {
      font-weight: 600;
      opacity: 0.9;
    }

    .backend-value {
      font-family: 'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', 'Courier New', monospace;
      background: rgba(255, 255, 255, 0.2);
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 13px;
      font-weight: 500;
      max-width: 400px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .chart-container {
      flex: 1;
      width: 100%;
      overflow: hidden;
    }

    .chart-main {
      width: 100%;
      height: 100%;
    }

    .in {
      padding: 10px;
      margin: 0;
      font-family: "JetBrains Mono", "SFMono-Regular", "SF-Mono", Menlo, Monaco, Consolas, "Liberation Mono", "Roboto Mono", "Ubuntu Mono", "Courier New", Courier, monospace;
    }

    .settings-button {
      padding: 8px 16px;
      background: rgba(255, 255, 255, 0.25);
      color: white;
      border: 1.5px solid rgba(255, 255, 255, 0.4);
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      backdrop-filter: blur(10px);
      transition: all 0.2s;
      white-space: nowrap;
    }

    .settings-button:hover {
      background: rgba(255, 255, 255, 0.35);
      border-color: rgba(255, 255, 255, 0.6);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .settings-button:active {
      transform: translateY(0);
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      animation: fadeIn 0.2s;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      padding: 24px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.3s;
    }

    @keyframes slideIn {
      from {
        transform: translateY(-20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .modal-header {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 20px;
      color: #333;
      padding-bottom: 12px;
      border-bottom: 2px solid #f0f0f0;
    }

    .modal-section {
      margin-bottom: 20px;
    }

    .modal-label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: #555;
      margin-bottom: 8px;
    }

    .modal-input {
      width: 100%;
      padding: 10px 12px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 14px;
      box-sizing: border-box;
      transition: border-color 0.2s;
    }

    .modal-input:focus {
      outline: none;
      border-color: #007bff;
    }

    .saved-list {
      margin-top: 8px;
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      background: #fff;
    }

    .saved-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 14px;
      border-bottom: 1px solid #f0f0f0;
      transition: all 0.2s ease;
      cursor: pointer;
      position: relative;
    }

    .saved-item:last-child {
      border-bottom: none;
    }

    .saved-item:hover {
      background: #f8f9fa;
      padding-left: 18px;
    }

    .saved-item.active {
      background: linear-gradient(90deg, #e7f3ff 0%, #f0f8ff 100%);
      border-left: 4px solid #007bff;
      padding-left: 14px;
      font-weight: 600;
    }

    .saved-item-text {
      flex: 1;
      font-size: 14px;
      color: #2c3e50;
      font-family: 'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', 'Courier New', monospace;
      font-weight: 500;
      line-height: 1.6;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      letter-spacing: 0.3px;
    }

    .saved-item-delete {
      padding: 4px 8px;
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      margin-left: 8px;
      transition: background 0.2s;
    }

    .saved-item-delete:hover {
      background: #c82333;
    }

    .empty-list {
      padding: 30px 20px;
      text-align: center;
      color: #6c757d;
      font-size: 14px;
      font-style: italic;
    }

    .button-group {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }

    .save-current-button {
      flex: 1;
      padding: 8px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      transition: background 0.2s;
      white-space: nowrap;
    }

    .save-current-button:hover {
      background: #218838;
    }

    .save-current-button:disabled {
      background: #6c757d;
      cursor: not-allowed;
    }

    .use-current-button {
      flex: 1;
      padding: 8px;
      background: #17a2b8;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      transition: background 0.2s;
      white-space: nowrap;
    }

    .use-current-button:hover {
      background: #138496;
    }

    .current-url {
      background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
      padding: 14px 16px;
      border-radius: 8px;
      font-size: 14px;
      color: #1a1a1a;
      word-break: break-all;
      font-family: 'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', 'Courier New', monospace;
      font-weight: 600;
      line-height: 1.7;
      letter-spacing: 0.5px;
      border: 1px solid #dee2e6;
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
    }

    .modal-actions {
      display: flex;
      gap: 10px;
      margin-top: 24px;
      justify-content: flex-end;
    }

    .modal-button {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s;
    }

    .modal-button-primary {
      background: #007bff;
      color: white;
    }

    .modal-button-primary:hover {
      background: #0056b3;
    }

    .modal-button-secondary {
      background: #6c757d;
      color: white;
    }

    .modal-button-secondary:hover {
      background: #5a6268;
    }

    .modal-button-danger {
      background: #dc3545;
      color: white;
    }

    .modal-button-danger:hover {
      background: #c82333;
    }

    .import-export-group {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }

    .export-button {
      flex: 1;
      padding: 8px;
      background: #6f42c1;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      transition: background 0.2s;
      white-space: nowrap;
    }

    .export-button:hover {
      background: #5a32a3;
    }

    .export-button:disabled {
      background: #6c757d;
      cursor: not-allowed;
    }

    .import-button {
      flex: 1;
      padding: 8px;
      background: #fd7e14;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      transition: background 0.2s;
      white-space: nowrap;
    }

    .import-button:hover {
      background: #e96b02;
    }

    .import-preview {
      margin-top: 12px;
      padding: 12px;
      background: #fff3cd;
      border: 1px solid #ffc107;
      border-radius: 6px;
    }

    .import-preview-label {
      font-size: 13px;
      font-weight: 600;
      color: #856404;
      margin-bottom: 8px;
    }

    .import-preview-textarea {
      width: 100%;
      height: 100px;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-family: 'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', 'Courier New', monospace;
      font-size: 12px;
      resize: vertical;
      box-sizing: border-box;
    }

    .import-preview-warning {
      margin-top: 8px;
      padding: 8px;
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      border-radius: 4px;
      color: #721c24;
      font-size: 12px;
    }

    .import-preview-actions {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }

    .import-confirm-button {
      flex: 1;
      padding: 8px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      transition: background 0.2s;
    }

    .import-confirm-button:hover {
      background: #218838;
    }

    .import-cancel-button {
      flex: 1;
      padding: 8px;
      background: #6c757d;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      transition: background 0.2s;
    }

    .import-cancel-button:hover {
      background: #5a6268;
    }

    .import-status {
      margin-top: 8px;
      padding: 8px;
      border-radius: 4px;
      font-size: 12px;
    }

    .import-status.success {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
    }

    .import-status.error {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
    }
  </style>
  <script
    src="https://us.arloor.dev/https://cdnjs.cloudflare.com/ajax/libs/react/18.3.1/umd/react.production.min.js"></script>
  <script
    src="https://us.arloor.dev/https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.3.1/umd/react-dom.production.min.js"></script>
  <!-- use babel to transform your JSX code into regular JavaScript. -->
  <script
    src="https://us.arloor.dev/https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.26.1/babel.min.js"></script>

  <!--   <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script> -->
  <script src="https://us.arloor.dev/https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"></script>
  <!-- <script src="https://www.arloor.com/echarts.min.js"></script> -->
</head>

<body>
  <div id="app"></div>

  <script type="text/jsx">
        const API_PATH = '/net.json';  // å›ºå®šçš„ API è·¯å¾„
        const SAVED_BACKENDS_KEY = 'saved_backends';  // localStorage é”®å

        const query = new URLSearchParams(window.location.search);
        let initialBackendUrl = query.get('backend'); // ä» URL å‚æ•°è¯»å–åç«¯åœ°å€

        // å°è¯•ä» localStorage è¯»å–ä¿å­˜çš„åç«¯åœ°å€
        const savedBackend = localStorage.getItem('backend_url');
        if (savedBackend) {
          initialBackendUrl = savedBackend;
        }

        // å¦‚æœæ²¡æœ‰è®¾ç½®åç«¯åœ°å€ï¼Œä½¿ç”¨ç©ºå­—ç¬¦ä¸²è¡¨ç¤ºå½“å‰åŸŸå
        if (!initialBackendUrl) {
          initialBackendUrl = '';
        }

        // ä» localStorage è¯»å–å·²ä¿å­˜çš„åç«¯åœ°å€åˆ—è¡¨
        function loadSavedBackends() {
          try {
            const saved = localStorage.getItem(SAVED_BACKENDS_KEY);
            return saved ? JSON.parse(saved) : [];
          } catch {
            return [];
          }
        }

        // ä¿å­˜åç«¯åœ°å€åˆ—è¡¨åˆ° localStorage
        function saveSavedBackends(backends) {
          localStorage.setItem(SAVED_BACKENDS_KEY, JSON.stringify(backends));
        }

        function App() {
          const [backendUrl, setBackendUrl] = React.useState(initialBackendUrl);
          const [showModal, setShowModal] = React.useState(false);
          const [tempBackendUrl, setTempBackendUrl] = React.useState(initialBackendUrl);
          const [savedBackends, setSavedBackends] = React.useState(loadSavedBackends());
          const [importPreview, setImportPreview] = React.useState(null); // { text: string, parsed: array | null, error: string | null }
          const [importStatus, setImportStatus] = React.useState(null); // { type: 'success' | 'error', message: string }

          // æ ¹æ®åç«¯åœ°å€æ„å»ºå®Œæ•´çš„æ•°æ® URL
          const dataUrl = React.useMemo(() => {
            const backend = backendUrl.trim();
            if (!backend) {
              // ç©ºå­—ç¬¦ä¸²è¡¨ç¤ºä½¿ç”¨å½“å‰åŸŸå
              return API_PATH;
            }
            // ç§»é™¤æœ«å°¾çš„æ–œæ 
            const cleanBackend = backend.replace(/\/+$/, '');
            return cleanBackend + API_PATH;
          }, [backendUrl]);

          React.useEffect(() => {
            const mainDiv = document.getElementById('main');
            let myChart = echarts.init(mainDiv);
            myChart.showLoading();
            window.addEventListener('resize', myChart.resize);
            refresh(myChart, dataUrl);

            const intervalId = setInterval(() => {
              refresh(myChart, dataUrl);
            }, 5000); // æ¯5ç§’æ‰§è¡Œä¸€æ¬¡

            // æ¸…é™¤å®šæ—¶å™¨
            return () => {
              clearInterval(intervalId)
              window.removeEventListener('resize', myChart.resize);
              myChart.dispose();
            };
          }, [dataUrl]);

          const handleOpenModal = () => {
            setTempBackendUrl(backendUrl);
            setShowModal(true);
          };

          const handleCloseModal = () => {
            setShowModal(false);
          };

          const handleSave = () => {
            setBackendUrl(tempBackendUrl);
            localStorage.setItem('backend_url', tempBackendUrl);
            setShowModal(false);
          };

          const handleSaveToList = () => {
            const trimmedUrl = tempBackendUrl.trim();
            if (!trimmedUrl) {
              alert('è¯·è¾“å…¥åç«¯åœ°å€');
              return;
            }
            if (savedBackends.includes(trimmedUrl)) {
              alert('è¯¥åœ°å€å·²å­˜åœ¨');
              return;
            }
            const newBackends = [...savedBackends, trimmedUrl];
            setSavedBackends(newBackends);
            saveSavedBackends(newBackends);
          };

          const handleUseCurrent = () => {
            setTempBackendUrl('');
          };

          const handleSelectSaved = (url) => {
            setTempBackendUrl(url);
          };

          const handleDeleteSaved = (url, e) => {
            e.stopPropagation();
            const newBackends = savedBackends.filter(b => b !== url);
            setSavedBackends(newBackends);
            saveSavedBackends(newBackends);
          };

          const handleModalKeyPress = (e) => {
            if (e.key === 'Enter') {
              handleSave();
            } else if (e.key === 'Escape') {
              handleCloseModal();
            }
          };

          const handleExport = async () => {
            try {
              const jsonStr = JSON.stringify(savedBackends, null, 2);
              await navigator.clipboard.writeText(jsonStr);
              setImportStatus({ type: 'success', message: 'å·²å¯¼å‡ºåˆ°å‰ªè´´æ¿ï¼' });
              setTimeout(() => setImportStatus(null), 3000);
            } catch (err) {
              setImportStatus({ type: 'error', message: 'å¯¼å‡ºå¤±è´¥: ' + err.message });
            }
          };

          const handleImport = async () => {
            try {
              const text = await navigator.clipboard.readText();
              let parsed = null;
              let error = null;
              try {
                const data = JSON.parse(text);
                if (Array.isArray(data) && data.every(item => typeof item === 'string')) {
                  parsed = data;
                } else {
                  error = 'æ ¼å¼é”™è¯¯ï¼šéœ€è¦å­—ç¬¦ä¸²æ•°ç»„';
                }
              } catch (e) {
                error = 'è§£æå¤±è´¥ï¼šä¸æ˜¯æœ‰æ•ˆçš„ JSON æ ¼å¼';
              }
              setImportPreview({ text, parsed, error });
              setImportStatus(null);
            } catch (err) {
              setImportPreview({ text: '', parsed: null, error: 'è¯»å–å‰ªè´´æ¿å¤±è´¥: ' + err.message });
            }
          };

          const handleImportConfirm = () => {
            if (importPreview && importPreview.parsed) {
              setSavedBackends(importPreview.parsed);
              saveSavedBackends(importPreview.parsed);
              setImportStatus({ type: 'success', message: 'å¯¼å…¥æˆåŠŸï¼å·²è¦†ç›–åŸæœ‰åˆ—è¡¨ã€‚' });
              setImportPreview(null);
            }
          };

          const handleImportCancel = () => {
            setImportPreview(null);
          };

          const handleImportTextChange = (e) => {
            const text = e.target.value;
            let parsed = null;
            let error = null;
            try {
              const data = JSON.parse(text);
              if (Array.isArray(data) && data.every(item => typeof item === 'string')) {
                parsed = data;
              } else {
                error = 'æ ¼å¼é”™è¯¯ï¼šéœ€è¦å­—ç¬¦ä¸²æ•°ç»„';
              }
            } catch (e) {
              error = 'è§£æå¤±è´¥ï¼šä¸æ˜¯æœ‰æ•ˆçš„ JSON æ ¼å¼';
            }
            setImportPreview({ text, parsed, error });
          };

          return (
            <div className='app-container'>
              <div className='top-bar'>
                <div className='backend-info'>
                  <span className='backend-label'>å½“å‰åç«¯:</span>
                  <span className='backend-value' title={backendUrl || 'å½“å‰åŸŸå'}>
                    {backendUrl || 'å½“å‰åŸŸå'}
                  </span>
                </div>
                <button className='settings-button' onClick={handleOpenModal}>
                  âš™ï¸ åç«¯è®¾ç½®
                </button>
              </div>

              <div className='chart-container'>
                <div id='main' className='chart-main'></div>
              </div>

              {showModal && (
                <div className='modal-overlay' onClick={handleCloseModal}>
                  <div className='modal-content' onClick={(e) => e.stopPropagation()}>
                    <div className='modal-header'>
                      åç«¯åœ°å€è®¾ç½®
                    </div>

                    <div className='modal-section'>
                      <label className='modal-label'>åç«¯åœ°å€</label>
                      <input
                        className='modal-input'
                        type="text"
                        value={tempBackendUrl}
                        onChange={(e) => setTempBackendUrl(e.target.value)}
                        onKeyDown={handleModalKeyPress}
                        placeholder="ç•™ç©ºä½¿ç”¨å½“å‰åŸŸåï¼Œæˆ–è¾“å…¥å¦‚: https://example.com"
                        autoFocus
                      />
                      <div className='button-group'>
                        <button
                          className='save-current-button'
                          onClick={handleSaveToList}
                          disabled={!tempBackendUrl.trim() || savedBackends.includes(tempBackendUrl.trim())}
                        >
                          ğŸ’¾ ä¿å­˜æ­¤åœ°å€åˆ°åˆ—è¡¨
                        </button>
                        <button
                          className='use-current-button'
                          onClick={handleUseCurrent}
                        >
                          ğŸ  ä½¿ç”¨å½“å‰æœåŠ¡å™¨
                        </button>
                      </div>
                    </div>

                    <div className='modal-section'>
                      <label className='modal-label'>å·²ä¿å­˜çš„åç«¯åœ°å€</label>
                      <div className='saved-list'>
                        {savedBackends.length === 0 ? (
                          <div className='empty-list'>æš‚æ— ä¿å­˜çš„åœ°å€</div>
                        ) : (
                          savedBackends.map((url) => (
                            <div
                              key={url}
                              className={`saved-item ${tempBackendUrl === url ? 'active' : ''}`}
                              onClick={() => handleSelectSaved(url)}
                            >
                              <div className='saved-item-text' title={url}>
                                {url || 'å½“å‰åŸŸå'}
                              </div>
                              <button
                                className='saved-item-delete'
                                onClick={(e) => handleDeleteSaved(url, e)}
                              >
                                åˆ é™¤
                              </button>
                            </div>
                          ))
                        )}
                      </div>
                      <div className='import-export-group'>
                        <button
                          className='export-button'
                          onClick={handleExport}
                          disabled={savedBackends.length === 0}
                        >
                          ğŸ“¤ å¯¼å‡ºåˆ°å‰ªè´´æ¿
                        </button>
                        <button
                          className='import-button'
                          onClick={handleImport}
                        >
                          ğŸ“¥ ä»å‰ªè´´æ¿å¯¼å…¥
                        </button>
                      </div>
                      {importStatus && (
                        <div className={`import-status ${importStatus.type}`}>
                          {importStatus.message}
                        </div>
                      )}
                      {importPreview && (
                        <div className='import-preview'>
                          <div className='import-preview-label'>å¯¼å…¥é¢„è§ˆ</div>
                          <textarea
                            className='import-preview-textarea'
                            value={importPreview.text}
                            onChange={handleImportTextChange}
                            placeholder='JSON æ ¼å¼çš„åç«¯åœ°å€æ•°ç»„'
                          />
                          {importPreview.error && (
                            <div className='import-status error'>{importPreview.error}</div>
                          )}
                          {importPreview.parsed && (
                            <div className='import-status success'>
                              è§£ææˆåŠŸï¼šå…± {importPreview.parsed.length} ä¸ªåœ°å€
                            </div>
                          )}
                          <div className='import-preview-warning'>
                            âš ï¸ ç¡®è®¤å¯¼å…¥å°†ä¼šè¦†ç›–å½“å‰å·²ä¿å­˜çš„æ‰€æœ‰åç«¯åœ°å€ï¼
                          </div>
                          <div className='import-preview-actions'>
                            <button
                              className='import-confirm-button'
                              onClick={handleImportConfirm}
                              disabled={!importPreview.parsed}
                            >
                              âœ… ç¡®è®¤å¯¼å…¥
                            </button>
                            <button
                              className='import-cancel-button'
                              onClick={handleImportCancel}
                            >
                              âŒ å–æ¶ˆ
                            </button>
                          </div>
                        </div>
                      )}
                    </div>

                    <div className='modal-section'>
                      <label className='modal-label'>å½“å‰è¯·æ±‚ URL</label>
                      <div className='current-url'>
                        {tempBackendUrl ? tempBackendUrl.replace(/\/+$/, '') + API_PATH : API_PATH}
                      </div>
                    </div>

                    <div className='modal-actions'>
                      <button className='modal-button modal-button-secondary' onClick={handleCloseModal}>
                        å–æ¶ˆ
                      </button>
                      <button className='modal-button modal-button-primary' onClick={handleSave}>
                        åº”ç”¨
                      </button>
                    </div>
                  </div>
                </div>
              )}
            </div>
          );
        }
        const refresh = (myChart, url) => fetch(url)
          .then(res => res.json()).then(data => {
            // console.log("net.json is", new Date(), JSON.stringify(data));
            var xAxisData = data.scales;
            if (data.scales.length === 0) {
              myChart.showLoading();
              return;
            }
            myChart.hideLoading();
            let series = []
            data.series_vec.forEach(ele => {
              let tmpSeries = {
                ...baseSeries,
                "data": ele.data,
                "name": ele.name,
              };
              if (ele.show_avg_line) {
                tmpSeries.markLine = avgMarkLine;
              }
              if (ele.show_max_point) {
                tmpSeries.markPoint = maxMarkPoint;
              }
              if (ele.color) {
                tmpSeries.itemStyle = {
                  color: ele.color,
                }
              }
              if (ele.type) {
                tmpSeries.type = ele.type
              }
              series.push(tmpSeries);
            });
            let max = series.map(s => s.data).flat().reduce((a, b) => Math.max(a, b));
            var c = Math.floor(Math.log(max) / Math.log(1024));
            let interval = Math.pow(1024, c);
            while (max / interval > 10) {
              interval *= 2;
            }
            // console.log("interval is", formatDataRateIEC(interval));
            // æŒ‡å®šå›¾è¡¨çš„é…ç½®é¡¹å’Œæ•°æ®
            var option = {
              color: ['#667eea', '#9921e8', '#f093fb', '#4facfe', '#43e97b', '#fa709a', '#fee140', '#30cfd0'],
              title: {
                text: ''
              },
              tooltip: {
                trigger: 'axis',
                formatter: series => {
                  return series[0].name + series.map(s => '<br/>' + s.seriesName + ': ' + formatDataRateIEC(s.value, 4)).join('');
                },
                backgroundColor: 'rgba(50, 50, 50, 0.9)',
                borderColor: '#667eea',
                borderWidth: 1,
                textStyle: {
                  color: '#fff'
                }
              },
              legend: {
                data: series.map(s => s.name),
                textStyle: {
                  color: '#666'
                }
              },
              toolbox: {
                feature: {
                  mark: {
                    show: true
                  },
                  dataView: {
                    show: true,
                    readOnly: false
                  },
                  magicType: {
                    show: true,
                    type: ['line', 'bar']
                  },
                  restore: {
                    show: true
                  },
                  saveAsImage: {
                    show: true
                  }
                }
              },
              xAxis: {
                type: 'category',
                boundaryGap: false,
                data: xAxisData
              },
              yAxis: {
                type: "value",
                max: value => Math.ceil(value.max / interval) * interval,
                interval: interval,
                axisLabel: {
                  formatter: (value, index) => formatDataRateIEC(value)
                },
                axisLine: {
                  show: true,
                },
                axisTick: {
                  show: true,
                }
              },
              series: series,
              animation: false,
              animationDuration: 5
            };
            // ä½¿ç”¨åˆšæŒ‡å®šçš„é…ç½®é¡¹å’Œæ•°æ®æ˜¾ç¤ºå›¾è¡¨ã€‚
            myChart.setOption(option);
          }).catch(e => {
            console.error("æ›´æ–°å¤±è´¥", e);
            myChart.showLoading();
          });
        
        const baseSeries = {
          // itemStyle: {
          //     color: '#ef0000',
          // },
          "smooth": true,
          "type": "line"
        }
        
        const maxMarkPoint = {
          "data": [{
            "type": "max",
            "name": "æœ€å¤§å€¼"
          }],
          symbol: "roundRect",
          symbolSize: [70, 30],
          "label": {
            formatter: value => formatDataRateIEC(value.value, 4)
          }
        }
        const avgMarkLine = {
          "data": [{
            "type": "average",
            "name": "å¹³å‡å€¼"
          }],
          "label": {
            formatter: value => formatDataRateIEC(value.value, 4)
          }
        };
        
        
        function formatDataRateIEC(num, precision = -1) {
          let value = null;
          if (num <= 0) {
            value = '0b/s';
          } else {
            var k = 1024;
            var sizes = ['b/s', 'Kb/s', 'Mb/s', 'Gb/s', 'Tb/s', 'Pb/s', 'Eb/s', 'Zb/s', 'Yb/s'];
            //è¿™é‡Œæ˜¯å–è‡ªç„¶å¯¹æ•°ï¼Œä¹Ÿå°±æ˜¯logï¼ˆkï¼‰ï¼ˆnumï¼‰ï¼Œæ±‚å‡ºä»¥kä¸ºåº•çš„å¤šå°‘æ¬¡æ–¹æ˜¯num
            var c = Math.floor(Math.log(num) / Math.log(k));
            if (precision === -1) {
              value = (num / Math.pow(k, c)) + ' ' + sizes[c];
            } else {
              value = (num / Math.pow(k, c)).toPrecision(precision) + ' ' + sizes[c];
            }
          }
          return value;
        }
        
        window.onload = ()=> {
          const app = document.getElementById("app")
          const root = ReactDOM.createRoot(app);
          root.render(<App />);
        };
      </script>
</body>

</html>